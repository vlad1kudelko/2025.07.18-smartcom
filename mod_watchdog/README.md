# SFTP Watchdog

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ SFTP —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤.

## –û–ø–∏—Å–∞–Ω–∏–µ

Watchdog –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –≤—Å–µ SFTP —Å–µ—Ä–≤–µ—Ä—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ —Ç–∞–±–ª–∏—Ü—É `files` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–Ω–æ–≤—ã–π".

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- üîç **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö SFTP —Å–µ—Ä–≤–µ—Ä–æ–≤ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- üìÅ **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö
- üíæ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö** –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–Ω–æ–≤—ã–π"
- üîÑ **–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º
- üìä **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## –ó–∞–ø—É—Å–∫

### –ß–µ—Ä–µ–∑ Docker Compose

```bash
# 1. –ó–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–Ω–∞—á–∞–ª–∞)
cd base
docker compose up -d

# 2. –ó–∞–ø—É—Å–∫ watchdog (–ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞)
cd mod_watchdog
docker compose up -d
```

**–í–∞–∂–Ω–æ:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º watchdog!

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
cd mod_watchdog
pip install -r requirements.txt
python main.py
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `DATABASE_URL` - URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- `SCAN_INTERVAL` - –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤

–î–æ–±–∞–≤—å—Ç–µ SFTP —Å–µ—Ä–≤–µ—Ä—ã –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Adminer (http://localhost:8080):

```sql
INSERT INTO servers (hostname, port, username, password) 
VALUES ('sftp_server', 22, 'testuser', 'password');
```

**–í–∞–∂–Ω–æ:** Watchdog –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è, –µ—Å–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤** - –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `servers`
2. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ SFTP** - –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –∫–∞–∂–¥–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
3. **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏** - –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π** - –Ω–∞—Ö–æ–¥–∏—Ç —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `files`
5. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤** - —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–Ω–æ–≤—ã–π"
6. **–û–∂–∏–¥–∞–Ω–∏–µ** - –∂–¥–µ—Ç 5 —Å–µ–∫—É–Ω–¥ –∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç —Ü–∏–∫–ª

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

Watchdog –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```
2024-01-01 12:00:00 - INFO - –ó–∞–ø—É—Å–∫ SFTP Watchdog
2024-01-01 12:00:01 - INFO - –ù–∞–π–¥–µ–Ω–æ 2 —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
2024-01-01 12:00:01 - INFO - –°–∫–∞–Ω–∏—Ä—É—é —Å–µ—Ä–≤–µ—Ä localhost:2222
2024-01-01 12:00:02 - INFO - –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É localhost:2222
2024-01-01 12:00:02 - INFO - –ù–∞–π–¥–µ–Ω–æ 3 —Ñ–∞–π–ª–æ–≤ –≤ /home/testuser/upload
2024-01-01 12:00:02 - INFO - –ù–∞–π–¥–µ–Ω–æ 2 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ localhost
2024-01-01 12:00:02 - INFO - –î–æ–±–∞–≤–ª–µ–Ω —Ñ–∞–π–ª large_file1.bin –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ 1
2024-01-01 12:00:02 - INFO - –î–æ–±–∞–≤–ª–µ–Ω —Ñ–∞–π–ª large_file2.bin –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞ 1
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker compose logs -f watchdog
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
docker compose ps
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker compose down
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
mod_watchdog/
‚îú‚îÄ‚îÄ main.py              # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ watchdog
‚îú‚îÄ‚îÄ requirements.txt     # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ Dockerfile          # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml  # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ README.md           # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º

Watchdog –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã:
- **base** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL
- **mod_admin** - –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∞–π–ª–æ–≤
- **sftp_servers** - —Ç–µ—Å—Ç–æ–≤—ã–µ SFTP —Å–µ—Ä–≤–µ—Ä—ã
- **minio** - –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

### –°–µ—Ç—å Docker:
Watchdog –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Å–µ—Ç–∏ `base_default`, –≥–¥–µ —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç:
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL (–ø–æ—Ä—Ç 5432)
- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (–ø–æ—Ä—Ç 8000)
- SFTP —Å–µ—Ä–≤–µ—Ä—ã (–ø–æ—Ä—Ç 2222)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ:
1. Watchdog —Å–∫–∞–Ω–∏—Ä—É–µ—Ç SFTP —Å–µ—Ä–≤–µ—Ä—ã –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
2. –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –±–∞–∑—É —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–Ω–æ–≤—ã–π"
3. –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
4. mod_downloader –º–æ–∂–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∞–π–ª—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–Ω–æ–≤—ã–π"

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞—É–¥–∏—Ç–∞
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è 